name: CI

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout código fuente
      uses: actions/checkout@v2

    - name: Clonar el repositorio irisapitester
      run: git clone https://github.com/daniel-aguilar-garcia/irisapitester.git

    - name: Levantar Docker Compose
      run: docker-compose up -d
      working-directory: ./irisapitester  # Asegúrate de actualizar la ruta correcta al directorio clonado

    - name: Esperar a que Docker esté listo
      run: sleep 30  # Esperar unos segundos para que Docker esté completamente levantado

    - name: Realizar petición GET
      run: curl -o resultado.html http://localhost:52773/pull_and_run_tests
    
    - name: Leer contenido del archivo resultado.html
      id: read_file
      run: |
        content=$(cat resultado.html)
        echo "::set-output name=content::$content"
    
    - name: Enviar email 
      uses: cinotify/github-action@main
      with:
        to: 'tetofe2962@wiemei.com'
        subject: 'building main'
        body: ${{ steps.read_file.outputs.content }}

